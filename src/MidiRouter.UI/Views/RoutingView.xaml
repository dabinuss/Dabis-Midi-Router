<UserControl x:Class="MidiRouter.UI.Views.RoutingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="450"
             d:DesignWidth="800">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="8" />
            <RowDefinition Height="2*" />
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="8" />
            <RowDefinition Height="2*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0">
            <TextBlock DockPanel.Dock="Left"
                       VerticalAlignment="Center"
                       FontWeight="SemiBold"
                       Text="{Binding ServiceHealthStatus}" />
            <Button DockPanel.Dock="Right"
                    Content="Ports aktualisieren"
                    Command="{Binding RefreshEndpointsCommand}"
                    MinWidth="140" />
        </DockPanel>

        <Border Grid.Row="2"
                BorderBrush="#33000000"
                BorderThickness="1"
                Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="10" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="6" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="8" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Grid.ColumnSpan="3"
                           FontWeight="SemiBold"
                           Text="Port-Verwaltung" />

                <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal">
                    <TextBox Width="220"
                             Margin="0,0,8,0"
                             Text="{Binding NewPortName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <Button Content="Port erstellen"
                            Command="{Binding CreatePortCommand}"
                            MinWidth="130" />
                </StackPanel>

                <StackPanel Grid.Row="2" Grid.Column="2" Orientation="Horizontal">
                    <TextBox x:Name="EditPortNameTextBox"
                             Width="220"
                             Margin="0,0,8,0"
                             Text="{Binding EditPortName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <Button Content="Port ändern"
                            Command="{Binding RenamePortCommand}"
                            MinWidth="120"
                            Margin="0,0,8,0" />
                    <Button Content="Port löschen"
                            Command="{Binding DeletePortCommand}"
                            MinWidth="120" />
                </StackPanel>

                <StackPanel Grid.Row="4"
                            Grid.ColumnSpan="3"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">
                    <CheckBox Content="System-Ports ausblenden"
                              IsChecked="{Binding HideSystemPorts, Mode=TwoWay}"
                              Margin="0,0,12,0" />
                    <TextBox Width="220"
                             Margin="0,0,8,0"
                             ToolTip="Suche in Name, ID, Typ, Eigentümer, Richtung"
                             Text="{Binding PortSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <ComboBox Width="160"
                              Margin="0,0,8,0"
                              ItemsSource="{Binding PortOwnerFilters}"
                              SelectedItem="{Binding SelectedPortOwnerFilter, Mode=TwoWay}" />
                    <ComboBox Width="160"
                              ItemsSource="{Binding PortDirectionFilters}"
                              SelectedItem="{Binding SelectedPortDirectionFilter, Mode=TwoWay}" />
                </StackPanel>
            </Grid>
        </Border>

        <DataGrid Grid.Row="4"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  ItemsSource="{Binding Ports}"
                  SelectedItem="{Binding SelectedPort, Mode=TwoWay}"
                  ScrollViewer.HorizontalScrollBarVisibility="Auto">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="2*" />
                <DataGridTextColumn Header="Typ" Binding="{Binding Type}" Width="*" />
                <DataGridTextColumn Header="Richtung" Binding="{Binding Direction}" Width="*" />
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="*" />
                <DataGridTextColumn Header="Eigentümer" Binding="{Binding Owner}" Width="*" />
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="3*" />
            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="6"
                BorderBrush="#33000000"
                BorderThickness="1"
                Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="6" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Grid.ColumnSpan="6"
                           FontWeight="SemiBold"
                           Text="Routing" />

                <ComboBox Grid.Row="2"
                          Grid.Column="0"
                          Margin="0,0,8,0"
                          DisplayMemberPath="Name"
                          SelectedValuePath="Id"
                          SelectedValue="{Binding SelectedSourceEndpointId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          ItemsSource="{Binding SourceEndpoints}" />

                <ComboBox Grid.Row="2"
                          Grid.Column="1"
                          Margin="0,0,8,0"
                          DisplayMemberPath="Name"
                          SelectedValuePath="Id"
                          SelectedValue="{Binding SelectedTargetEndpointId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          ItemsSource="{Binding TargetEndpoints}" />

                <CheckBox Grid.Row="2"
                          Grid.Column="2"
                          VerticalAlignment="Center"
                          Content="Aktiv"
                          IsChecked="{Binding RouteEnabled, Mode=TwoWay}" />

                <TextBox Grid.Row="2"
                         Grid.Column="3"
                         Margin="8,0,8,0"
                         Text="{Binding RouteChannelsText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                <TextBox Grid.Row="2"
                         Grid.Column="4"
                         Margin="0,0,8,0"
                         Text="{Binding RouteTypesText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                <StackPanel Grid.Row="2" Grid.Column="5" Orientation="Horizontal">
                    <Button Content="Neu"
                            Command="{Binding NewRouteCommand}"
                            MinWidth="70"
                            Margin="0,0,8,0" />
                    <Button Content="Speichern"
                            Command="{Binding SaveRouteCommand}"
                            MinWidth="90"
                            Margin="0,0,8,0" />
                    <Button Content="Entfernen"
                            Command="{Binding DeleteRouteCommand}"
                            MinWidth="90" />
                </StackPanel>
            </Grid>
        </Border>

        <DataGrid Grid.Row="8"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  ItemsSource="{Binding Routes}"
                  SelectedValuePath="Id"
                  SelectedValue="{Binding SelectedRouteId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                  ScrollViewer.HorizontalScrollBarVisibility="Auto">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Source" Binding="{Binding SourceName}" Width="2*" />
                <DataGridTextColumn Header="Target" Binding="{Binding TargetName}" Width="2*" />
                <DataGridCheckBoxColumn Header="Aktiv" Binding="{Binding Enabled}" Width="*" />
                <DataGridTextColumn Header="Kanäle" Binding="{Binding Channels}" Width="2*" />
                <DataGridTextColumn Header="Typen" Binding="{Binding MessageTypes}" Width="2*" />
                <DataGridTemplateColumn Header="Bearbeiten" Width="Auto">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Laden"
                                    Padding="8,2"
                                    Command="{Binding DataContext.SelectRouteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding Id}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <TextBlock Grid.Row="9"
                   Margin="0,8,0,0"
                   Foreground="#B00020"
                   Text="{Binding ValidationMessage}" />
    </Grid>
</UserControl>
